<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PWA Studio Pro – Build • Analyze • Deploy</title>
  <meta name="description" content="PWA Studio Pro ist das ultimative Tool zum Erstellen, Analysieren und Bereitstellen von Progressive Web Apps. Inklusive Manifest-, Service-Worker-, Supabase- und Deployment-Generator.">
  <meta name="keywords" content="PWA, Progressive Web App, Generator, Service Worker, Manifest, Supabase, GitHub Pages, Deployment, Analyzer, Checker, Builder">
  <meta property="og:title" content="PWA Studio Pro – Build • Analyze • Deploy">
  <meta property="og:description" content="Das All-in-One PWA Toolkit: Erstelle, analysiere und veröffentliche Progressive Web Apps mit nur wenigen Klicks.">
  <meta property="og:type" content="website">
  <meta name="author" content="Björn Voss aka Omega">

  <meta name="theme-color" content="#1e40af" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#111827" media="(prefers-color-scheme: dark)">
  <link rel="manifest" href="manifest.json">

  <style>
    :root {
      --primary-color: #3b82f6; --background-color: #f1f5f9; --text-color: #1f2937;
      --card-background: #ffffff; --header-gradient: linear-gradient(135deg, #1e40af, #1d4ed8);
      --input-bg: #f9fafb; --border-color: #d1d5db; --subtle-text: #6b7280;
      --success-bg: #f0fff4; --success-border: #38a169; --success-text: #2f855a;
    }
    html.dark {
      --background-color: #111827; --text-color: #d1d5db; --card-background: #1f2937;
      --input-bg: #374151; --border-color: #4b5563; --subtle-text: #9ca3af;
      --success-bg: #1a3627; --success-border: #48bb78; --success-text: #9ae6b4;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      width: 100%; max-width: 100%; overflow-x: hidden;
      background: var(--background-color); color: var(--text-color);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      transition: background-color 0.3s, color 0.3s;
      -webkit-text-size-adjust: 100%;
      display: flex; flex-direction: column; min-height: 100vh;
      scroll-behavior: smooth;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    input, textarea, code,
    #supabaseSuggestionContainer .table-name-display code,
    #supabaseSuggestionContainer table code,
    #supabaseSuggestionContainer button#copySqlButton,
    .correction-box textarea {
        user-select: text;
       -webkit-user-select: text;
       -moz-user-select: text;
       -ms-user-select: text;
    }

    header {
      background: var(--header-gradient);
      color: white; text-align: center; padding: 1rem; /* Padding angepasst */
      font-size: 1.2rem; /* Haupt-Schriftgröße angepasst */
      font-weight: 700; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      display: flex; align-items: center; justify-content: space-between;
      position: relative; transition: background 0.3s;
      min-height: 70px; /* Mindesthöhe für Stabilität */
    }
    /* NEU: Container für Header-Text */
    .header-title-container {
        flex-grow: 1; /* Nimmt verfügbaren Platz ein */
        text-align: center;
        padding: 0 10px; /* Kleiner horizontaler Puffer zum Button */
        line-height: 1.3; /* Zeilenhöhe für 2 Zeilen */
    }
    .header-title-container .main-title {
        font-size: 1.3rem; /* Etwas größer für Haupttitel */
        display: block; /* Eigene Zeile */
    }
     .header-title-container .subtitle {
        font-size: 0.85rem; /* Kleiner für Untertitel */
        font-weight: 400; /* Weniger fett */
        opacity: 0.9; /* Leicht transparent */
        display: block; /* Eigene Zeile */
        margin-top: 2px; /* Kleiner Abstand oben */
     }

    main { flex: 1; padding: 1rem; width: 100%; max-width: 800px; margin: 0 auto; }
    .card {
      background: var(--card-background); border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      padding: 1.5rem; margin-bottom: 1.5rem; width: 100%;
      transition: background-color 0.3s;
    }
    .output-card {
        background: #f8f8f8; box-shadow: none !important; padding: 1rem;
        border-radius: 8px; margin-top: 15px; border: 1px solid var(--border-color);
    }
    html.dark .output-card { background: #1f2937; }
    label { display: flex; align-items: center; margin-top: 12px; font-weight: 600; font-size: 0.95rem; }
    input, select, textarea {
      width: 100%; display: block; padding: 12px; margin-top: 5px;
      border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem;
      background: var(--input-bg);
      color: inherit;
    }
    input[type="color"] { padding: 5px; height: 50px; cursor: pointer; }
    input:focus, select:focus, textarea:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25); outline: none; }
    button:not(.tab-button):not(.fab) {
      display: block; width: 100%; background: var(--primary-color); color: white;
      padding: 14px; border: none; border-radius: 8px; font-size: 1.1rem;
      margin-top: 1rem; cursor: pointer; transition: all 0.2s;
      box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5);
    }
    button:disabled { background: #9ca3af; box-shadow: none; cursor: not-allowed; }
    .copy-btn { background: #10b981; margin-top: 0.8rem; }
    .action-group { display: flex; gap: 10px; margin-top: 1rem; flex-wrap: wrap; }
    .action-group button { flex-grow: 1; margin: 0; padding: 12px; font-size: 0.95rem; }

    .tabs-container {
      display: flex; margin-bottom: 1.5rem; background: var(--card-background);
      border-radius: 12px; padding: 5px; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      overflow-x: auto; -webkit-overflow-scrolling: touch; border: 1px solid var(--border-color);
      scrollbar-width: none; position: relative;
    }
    .tabs-container::-webkit-scrollbar { display: none; }

    .scroll-indicator {
        position: absolute; top: 50%; right: 8px; transform: translateY(-50%);
        width: 24px; height: 24px; background-color: rgba(59, 130, 246, 0.1);
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        pointer-events: none; opacity: 0; transition: opacity 0.3s;
        animation: pulse 2s infinite;
    }
    .scroll-indicator.visible { opacity: 1; }
    .scroll-indicator svg { stroke: var(--primary-color); }
    @keyframes pulse { 0%, 100% { transform: translateY(-50%) scale(1); } 50% { transform: translateY(-50%) scale(1.1); } }

    .tab-button {
      flex-shrink: 0; padding: 10px 15px; text-align: center; border: none; background: transparent;
      font-weight: 600; color: var(--subtle-text); cursor: pointer; border-radius: 8px;
      transition: all 0.2s; min-width: 105px; margin: 2px 4px;
    }
    .tab-button.active { background: var(--primary-color); color: white; box-shadow: 0 2px 6px rgba(59, 130, 246, 0.5); transform: translateY(-1px); }
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .analysis-result { background: #ecfdf5; border: 1px solid #a7f3d0; padding: 1rem; border-radius: 8px; margin-top: 1rem; }
    html.dark .analysis-result { background: #064e3b; border-color: #059669; }
    .correction-box { background: #fffbeb; border: 1px solid #fcd34d; padding: 1rem; border-radius: 8px; margin-top: 1rem;}
    html.dark .correction-box { background: #422006; border-color: #d97706;}
    .ok { color: #10b981; } .fail { color: #ef4444; }

    footer { background-color: #1f2937; color: #d1d5db; text-align: center; padding: 1.5rem; font-size: 0.75rem; margin-top: auto; }
    footer p { margin-bottom: 0.25rem; }
    footer a { color: #3b82f6; text-decoration: none; }
    .fab#downloadButton {
        display: none;
        position: fixed; bottom: 20px; right: 20px; background: #ef4444; color: white;
        width: 65px; height: 65px; font-size: 2rem; border: none; border-radius: 50%;
        box-shadow: 0 10px 20px rgba(239, 68, 68, 0.4); cursor: pointer; animation: fadeIn 0.5s;
        z-index: 999;
        display: flex; align-items: center; justify-content: center;
        padding: 0;
        line-height: 1;
    }


    #iconPreview { display: block; margin: 15px auto 0; width: 64px; height: 64px; border-radius: 12px; object-fit: cover; }
    #networkStatus { position: fixed; top: 0; left: 0; width: 100%; padding: 5px; text-align: center; font-size: 0.8rem; z-index: 1000; transform: translateY(-100%); transition: transform 0.3s; }
    .status-online { background: #d1fae5; color: #065f46; transform: translateY(0); }
    .status-offline { background: #fee2e2; color: #991b1b; transform: translateY(0); }
    code { background-color: #e5e7eb; padding: 2px 6px; border-radius: 4px; font-family: monospace; }
    html.dark code { background-color: #374151; }
    .option-group { margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color); }
    .option-group:first-child { margin-top: 0; padding-top: 0; border-top: none; }
    .option-group h3, #tutorial .option-group h3 {
      display: flex; align-items: center; margin-bottom: 10px; font-size: 1.1rem;
      border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;
      color: #1e40af;
    }
     html.dark .option-group h3, html.dark #tutorial .option-group h3 {
        color: var(--primary-color);
     }
    .option-group h4 {
        margin-top: 1.5rem; font-size: 1.1rem;
    }
     .option-group p {
        margin-bottom: 0.5rem;
        line-height: 1.6;
    }
     .option-group ol, .option-group ul {
        margin-top: 10px; margin-left: 25px;
    }
     .option-group li {
         margin-bottom: 5px;
    }

    .radio-group { display: flex; gap: 20px; margin-top: 10px; }
    .radio-group label { margin-top: 0; font-weight: normal; }
    .radio-group input { margin-right: 5px; width: auto; }
    .shortcut-entry { margin-top: 1rem; border-top: 1px solid #eee; padding-top: 1rem; }
    .shortcut-entry:first-child { margin-top: 0; border-top: none; padding-top: 0; }
    html.dark .shortcut-entry { border-top-color: #374151; }

    .info-icon {
        display: inline-block; width: 20px; height: 20px;
        background-color: #d1d5db; color: white; border-radius: 50%;
        text-align: center; font-weight: bold; font-style: italic;
        font-family: serif; line-height: 20px; cursor: pointer; margin-left: auto;
        font-size: 0.8rem; flex-shrink: 0;
    }
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6); z-index: 1000;
        display: none; align-items: center; justify-content: center;
        padding: 1rem;
    }
    .modal-content {
        background: white; padding: 1.5rem; border-radius: 12px;
        max-width: 500px; width: 100%; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        animation: fadeIn 0.3s;
    }
    html.dark .modal-content { background: var(--card-background); }
    .modal-content h3 { color: #1e40af; }
    html.dark .modal-content h3 { color: var(--primary-color); }
    .modal-content p { color: #4b5563; line-height: 1.6; }
    html.dark .modal-content p { color: var(--text-color); }
    .modal-content button { margin-top: 1.5rem; background: #6b7280; box-shadow: none; }

    #darkModeToggle {
        background: rgba(255,255,255,0.2); border: none; border-radius: 50%;
        width: 40px; height: 40px; cursor: pointer; padding: 8px;
        box-shadow: none; margin: 0; font-size: 1.2rem;
        line-height: 1; display: flex; align-items: center; justify-content: center;
        flex-shrink: 0; /* Verhindert Schrumpfen */
    }
    #darkModeToggle svg { display: none; }

    #supabaseSuggestionContainer {
        border-left: 4px solid var(--success-border);
        background: var(--success-bg);
        color: var(--success-text);
        padding: 1.5rem;
        border-radius: 8px;
    }
    #supabaseSuggestionContainer h4, #supabaseSuggestionContainer h4 svg { color: var(--success-text); stroke: var(--success-text); }
    #supabaseSuggestionContainer p, #supabaseSuggestionContainer ul, #supabaseSuggestionContainer li { color: var(--text-color); }
    html.dark #supabaseSuggestionContainer p, html.dark #supabaseSuggestionContainer ul, html.dark #supabaseSuggestionContainer li { color: #d1d5db; }
    #supabaseSuggestionContainer .table-name-display {
        background-color: rgba(255, 255, 255, 0.5);
        padding: 5px 10px;
        border-radius: 4px;
        margin-top: 8px;
        display: block;
        overflow-wrap: break-word;
        word-break: break-all;
    }
    html.dark #supabaseSuggestionContainer .table-name-display {
         background-color: rgba(0, 0, 0, 0.3);
    }

    /* WIZARD Stile */
    .wizard-step { display: none; }
    .wizard-step.active { display: block; animation: fadeIn 0.5s; }
    #wizard-progress-bar { width: 100%; height: 8px; background-color: #e5e7eb; border-radius: 4px; overflow: hidden; margin-bottom: 1.5rem;}
    #wizard-progress { width: 25%; height: 100%; background-color: var(--primary-color); transition: width 0.3s; }
    .wizard-nav { display: flex; justify-content: space-between; gap: 10px; margin-top: 1.5rem; }
    .wizard-nav button { flex-grow: 1; margin: 0; }
    .wizard-nav .prev-btn { background-color: #6b7280; }

    /* CHECKER Stile */
    #checkResults li { list-style: none; margin-bottom: 10px; font-weight: 500; }
    #checkResults .spinner { display: inline-block; width: 1em; height: 1em; border: 2px solid currentColor; border-right-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 8px;}
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>

    <script>
      const basePath = window.location.pathname.split('/').filter(Boolean)[0]
                       ? '/' + window.location.pathname.split('/')[0] + '/'
                       : '/';
      const manifestLink = document.createElement('link');
      manifestLink.rel = 'manifest';
      manifestLink.href = basePath + 'manifest.json';
      document.head.appendChild(manifestLink);
    </script>
<style>body{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style>
<style>input, textarea, code { user-select: text !important; -webkit-user-select: text !important; -moz-user-select: text !important; -ms-user-select: text !important; }</style>
</head>
<body>
  <div id="networkStatus"></div>
  <header>
    <div class="header-title-container">
        <span class="main-title">✨ PWA Studio Pro</span>
        <span class="subtitle">Build • Analyze • Deploy</span>
    </div>
    <button id="darkModeToggle" aria-label="Theme wechseln">🌗</button>
  </header>
  <main>
    <div class="tabs-container">
      <button class="tab-button active" data-tab="tutorial">1. 📖 Anleitung & Deployment</button>
      <button class="tab-button" data-tab="analyze">2. 🔍 Analysieren</button>
      <button class="tab-button" data-tab="generate">3. ⚙️ Generieren</button>
      <button class="tab-button" data-tab="check">4. ✅ Prüfen</button>
      <div class="scroll-indicator">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18L15 12L9 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <div id="tutorial" class="tab-content card active">
        <h2>📖 Anleitung: Von der Idee zur fertigen PWA</h2>
        <div class="option-group">
            <h3>Schritt 1: Projekt vorbereiten & Analysieren</h3>
            <p>Jede PWA startet mit einer HTML-Datei. Im Tab <strong>"2. 🔍 Analysieren"</strong> können Sie eine bestehende Datei hochladen, eine unserer Start-Vorlagen nutzen oder den Code direkt einfügen. Das Tool prüft die Datei, ergänzt fehlende PWA-Tags und kann sogar basierend auf Ihren Eingabefeldern eine passende Datenbank-Tabelle für Supabase vorschlagen.</p>
        </div>
        <div class="option-group">
            <h3>Schritt 2: PWA konfigurieren & generieren</h3>
            <p>Im Tab <strong>"3. ⚙️ Generieren"</strong> erwecken Sie Ihre App zum Leben. Ein Assistent führt Sie Schritt für Schritt durch die Konfiguration: Name, Icon, Farben, Caching-Verhalten und erweiterte Funktionen.</p>
        </div>
        <div class="option-group">
            <h3>Schritt 3: Download & Veröffentlichung mit GitHub</h3>
            <p>Nach der Generierung erscheint der rote <strong>Download-Button (⬇️)</strong>. Das resultierende ZIP-Archiv enthält alles, was Sie für die Veröffentlichung benötigen.</p>
            <h4>Standard-Deployment (ohne Supabase)</h4>
            <ol>
                <li>Erstellen Sie ein neues, öffentliches Repository auf GitHub.</li>
                <li>Laden Sie alle Dateien aus dem ZIP-Archiv (außer dem <code>.github</code>-Ordner) in dieses Repository hoch.</li>
                <li>Gehen Sie in den Repository-Einstellungen zu <strong>Settings > Pages</strong>.</li>
                <li>Wählen Sie als Quelle <strong>Deploy from a branch</strong>, als Branch <strong>main</strong> und als Ordner <strong>/ (root)</strong>. Speichern Sie.</li>
                <li>Nach 1-2 Minuten ist Ihre PWA unter der angezeigten URL erreichbar.</li>
            </ol>
            <h4>Deployment mit Supabase & GitHub Secrets (Sicher)</h4>
            <p>Wählen Sie diesen Weg, wenn Sie im Assistenten "Supabase" aktiviert haben.</p>
            <ol>
                <li><strong>Supabase-Projekt:</strong> Kopieren Sie Ihre <strong>Project URL</strong> und den <strong><code>anon / public</code> Key</strong> aus Ihren Supabase API-Einstellungen.</li>
                <li><strong>GitHub Secrets:</strong> Erstellen Sie in Ihrem GitHub Repository unter <strong>Settings > Secrets and variables > Actions</strong> zwei Secrets: <code>SUPABASE_URL</code> und <code>SUPABASE_ANON_KEY</code> mit den Werten aus Schritt 1.</li>
                <li><strong>Dateien hochladen:</strong> Laden Sie den **gesamten Inhalt** des ZIP-Archivs (inklusive des <code>.github</code>-Ordners) in Ihr Repo (Branch: <strong>main</strong>) hoch.</li>
                <li><strong>GitHub Pages aktivieren:</strong> Der Upload startet automatisch den Deployment-Prozess (die "Action"). Gehen Sie danach zu <strong>Settings > Pages</strong>, wählen Sie als Quelle <strong>Deploy from a branch</strong>, als Branch <strong>gh-pages</strong> (wichtig: *nicht* main!) und als Ordner <strong>/ (root)</strong>. Speichern Sie.</li>
            </ol>
        </div>
         <div class="option-group">
             <h3>Das Studio selbst bearbeiten & online stellen ("Meta-Workflow")</h3>
            <p>Sie können diese App benutzen, um sich selbst zu bearbeiten und als PWA auf ihrem eigenen GitHub zu hosten.</p>
            <ol>
                <li><strong>Code kopieren:</strong> Gehen Sie in die Entwickler-Tools Ihres Browsers, finden Sie das <code>&lt;html&gt;</code>-Element, klicken Sie rechts darauf und wählen Sie "OuterHTML kopieren".</li>
                <li><strong>Code einfügen:</strong> Fügen Sie den kompletten Code in den Editor im Tab <strong>"2. 🔍 Analysieren"</strong> ein und klicken Sie auf "Analysieren".</li>
                <li><strong>Konfigurieren & Generieren:</strong> Gehen Sie zu Tab 3. Geben Sie <strong>Ihren GitHub-Benutzernamen</strong> und einen neuen Repository-Namen für das Studio an. Aktivieren Sie alle gewünschten Features.</li>
                <li><strong>Download & Deployment:</strong> Laden Sie das ZIP herunter und folgen Sie der normalen Deployment-Anleitung oben.</li>
            </ol>
        </div>
        <div class="option-group">
            <h3>Schritt 4: PWA live prüfen</h3>
            <p>Sobald Ihre App online ist, können Sie im Tab <strong>"4. ✅ Prüfen"</strong> die URL eingeben, um zu testen, ob grundlegende PWA-Anforderungen wie ein Manifest und ein Service Worker vorhanden sind.</p>
        </div>
    </div>

    <div id="analyze" class="tab-content card">
      <h2>🔬 HTML-Analyse & Korrektur</h2>
        <div class="option-group">
            <h3>PWA-Starter-Vorlagen</h3>
            <p style="font-size:0.8rem; color: var(--subtle-text); margin-bottom: 10px;">Beginnen Sie ein neues Projekt mit einer fertigen Vorlage.</p>
            <div class="action-group">
                <button id="templateMinimal">Minimal PWA</button>
                <button id="templateTodo">Todo-App Vorlage</button>
            </div>
        </div>
        <div class="option-group">
            <h3>Eigene HTML-Datei</h3>
            <p>Laden Sie Ihre <code>index.html</code> hoch oder fügen Sie den Code in das Feld unten ein.</p>
            <input type="file" id="fileInput" accept=".html,.htm">
            <textarea id="htmlInput" rows="8" placeholder="... oder fügen Sie hier Ihren HTML-Code ein"></textarea>
            <button id="analyzeButton">🔍 HTML prüfen & korrigieren</button>
        </div>
        <div id="analysisOutput" class="analysis-result" style="display: none; margin-top: 1.5rem;"></div>
        <div id="correctionContainer" class="correction-box" style="display: none; margin-top: 1.5rem;">
            <h4>✅ Korrigierter HTML-Code (PWA Ready)</h4>
            <textarea id="correctedHtmlOutput" rows="10" readonly></textarea>
            <button class="copy-btn" id="copyButton">📋 Korrigierten Code kopieren</button>
        </div>
        <div id="supabaseSuggestionContainer" class="card" style="display: none; margin-top: 1.5rem;">
            </div>
    </div>

    <div id="generate" class="tab-content card">
      <h2>⚙️ PWA-Assistent</h2>
      <div id="wizard-progress-bar"><div id="wizard-progress"></div></div>

      <div id="wizard-step-1" class="wizard-step active">
        <div class="option-group">
          <h3>Schritt 1/4: Basis-Infos <span class="info-icon" data-info-key="basis">i</span></h3>
          <label for="githubUser">GitHub Benutzername:</label> <input id="githubUser" type="text" placeholder="z.B. user-name">
          <label for="repoName">Repository-Name:</label> <input id="repoName" type="text" placeholder="z.B. my-awesome-pwa">
          <label for="appName">App-Name (Voll):</label> <input id="appName" type="text" value="Meine PWA App">
          <label for="appShortName">App-Kurzname (Startbildschirm):</label> <input id="appShortName" type="text" value="PWA App">
          <label for="appDesc">Beschreibung:</label> <input id="appDesc" type="text" value="Erstellt mit PWA-Studio Pro.">
        </div>
      </div>

      <div id="wizard-step-2" class="wizard-step">
          <div class="option-group">
            <h3>Schritt 2/4: Design & Icon <span class="info-icon" data-info-key="design">i</span></h3>
            <label for="themeColor">Theme-Farbe (ändert den Header als Vorschau)</label>
            <input id="themeColor" type="color" value="#1e40af">
          </div>
          <div class="option-group">
            <h3>App Icon <span class="info-icon" data-info-key="icon">i</span></h3>
            <label for="iconUpload">Icon-Datei hochladen:</label>
            <input type="file" id="iconUpload" accept="image/png, image/jpeg">
            <div style="text-align: center; margin: 10px 0;">oder</div>
            <label for="iconInitials">Einfacher Icon-Generator:</label>
            <input type="text" id="iconInitials" placeholder="Initialen (z.B. AB)" maxlength="2">
            <label for="iconBgColor">Hintergrundfarbe:</label>
            <input type="color" id="iconBgColor" value="#3b82f6">
            <button id="generateIconButton" style="margin-top:10px; font-size: 0.9rem; padding: 10px;">Icon generieren</button>
            <img id="iconPreview" style="display:none;" alt="Icon Vorschau">
            <label style="margin-top: 1rem;"><input type="checkbox" id="generateMaskableIcon" style="width: auto; margin-right: 10px;">Maskable Icon generieren? <span class="info-icon" data-info-key="maskable">i</span></label>
          </div>
      </div>

      <div id="wizard-step-3" class="wizard-step">
        <div class="option-group">
          <h3>Schritt 3/4: Offline-Verhalten <span class="info-icon" data-info-key="caching">i</span></h3>
          <label for="swStrategy">Strategie</label>
          <select id="swStrategy">
              <option value="cache-first">Cache First (Standard & Schnell)</option>
              <option value="network-first">Network First (Aktuelle Daten)</option>
          </select>
          <label for="cacheVersion">Cache-Version:</label> <input id="cacheVersion" type="text" value="v1">
          <label for="extraFiles">Zusätzliche Dateien zum Cachen (automatisch erkannt):</label> <input id="extraFiles" type="text" placeholder="z. B. style.css, app.js">
        </div>
        <div class="option-group">
          <h3>App-Optionen <span class="info-icon" data-info-key="appOptions">i</span></h3>
          <div class="radio-group">
              <label><input type="radio" name="userSelect" value="enabled"> Text wählbar</label>
              <label><input type="radio" name="userSelect" value="disabled" checked> Text nicht wählbar</label>
          </div>
          <label style="margin-top: 20px;"><input type="checkbox" id="generateFooter" style="width: auto; margin-right: 10px;"> Footer in App einfügen?</label>
          <div id="footerFields" style="display: none;">
              <label for="footerLine1">Footer Zeile 1:</label> <input id="footerLine1" type="text" value="PWA Studio App">
              <label for="footerLine2">Footer Zeile 2:</label> <input id="footerLine2" type="text" value="Entwickler: Björn Voss aka Omega">
              <label for="footerLine3">Footer Zeile 3:</label> <input id="footerLine3" type="text" value="voss.1980@gmail.com">
          </div>
        </div>
      </div>

      <div id="wizard-step-4" class="wizard-step">
        <div class="option-group">
          <h3>Schritt 4/4: Erweiterte Funktionen (Optional) <span class="info-icon" data-info-key="advanced">i</span></h3>
          <label><input type="checkbox" id="addSupabase" style="width: auto; margin-right: 10px;">🔐 Supabase für GitHub Actions vorbereiten?</label>
          <div id="pushNotificationFields" style="margin-top: 10px;">
              <label><input type="checkbox" id="addPushNotifications" style="width: auto; margin-right: 10px;">🔔 Push-Benachrichtigungen aktivieren?</label>
              <div id="vapidKeyContainer" style="display: none; margin-left: 25px; margin-top: 5px;">
                  <label for="vapidKeyInput">VAPID Public Key (optional):</label>
                  <input type="text" id="vapidKeyInput" placeholder="Ihr Public VAPID Key">
              </div>
          </div>
          <label style="margin-top: 10px;"><input type="checkbox" id="addBackgroundSync" style="width: auto; margin-right: 10px;">🔄 Hintergrund-Synchronisation aktivieren?</label>
          <label style="margin-top: 10px;"><input type="checkbox" id="addShareTarget" style="width: auto; margin-right: 10px;">🎯 Als Ziel beim Teilen anbieten?</label>
           <div id="shareTargetFields" style="display: none;" class="output-card">
                <h4>Share Target Konfiguration</h4>
                <p style="font-size:0.8rem; color: #6b7280; margin-bottom: 10px;">Legt fest, wie Ihre App geteilte Links/Texte empfängt.</p>
                <label>Aktions-URL (z.B. /receive-share):</label><input type="text" id="shareTargetAction" value="/receive-share">
            </div>
        </div>
        <button id="generateButton">🚀 PWA-Dateien generieren</button>
      </div>

      <div class="wizard-nav">
        <button id="prev-btn" class="prev-btn" style="display: none;">Zurück</button>
        <button id="next-btn" class="next-btn">Weiter</button>
      </div>

      <div id="outputSection" class="card" style="margin-top: 30px; display: none;">
          <h2>📄 Code-Ausgabe</h2>
          <div class="output-card"> <h3>📦 Manifest (manifest.json)</h3> <textarea id="manifestOutput" rows="6" readonly></textarea> </div>
          <div class="output-card"> <h3>⚙️ Service Worker (sw.js)</h3> <textarea id="swOutput" rows="6" readonly></textarea> </div>
      </div>
    </div>

    <div id="check" class="tab-content card">
        <h2>✅ PWA Live-Prüfung</h2>
        <p style="font-size:0.9rem; color: var(--subtle-text); margin-bottom: 1rem;">Geben Sie die vollständige URL Ihrer veröffentlichten PWA ein, um zu prüfen, ob die wichtigsten Dateien erreichbar sind.</p>
        <label for="pwaUrlInput">PWA-URL:</label>
        <input type="url" id="pwaUrlInput" placeholder="https://user-name.github.io/repo-name/">
        <button id="checkPwaButton">🔍 PWA prüfen</button>
        <div id="checkResults" style="margin-top: 1.5rem;"></div>
    </div>

  </main>
  <button class="fab" id="downloadButton">⬇️</button>
  <footer id="appFooter">
    <p>PWA Studio Pro © 2025 – Build • Analyze • Deploy</p>
    <p>Entwickelt von Björn Voss aka Omega</p>
    <p><a href="mailto:voss.1980@gmail.com">voss.1980@gmail.com</a></p>
  </footer>
  <div id="infoModal" class="modal-overlay">
      <div class="modal-content">
          <h3 id="modalTitle"></h3>
          <p id="modalText"></p>
          <button id="modalCloseButton">Schließen</button>
      </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const pwaArtifacts = { manifest: null, sw: null, html: null, icon192: null, icon512: null, maskableIcon512: null, offlineHtml: null, shareReceiverHtml: null, supabaseClient: null, githubWorkflow: null, appJs: null };
        let uploadedIconBase64 = null;
        let correctedHtmlForZip = null;
        let currentWizardStep = 1;
        const totalWizardSteps = 4;

        const ui = {
            tabsContainer: document.querySelector('.tabs-container'),
            infoModal: document.getElementById('infoModal'),
            modalTitle: document.getElementById('modalTitle'),
            modalText: document.getElementById('modalText'),
            modalCloseButton: document.getElementById('modalCloseButton'),
            fileInput: document.getElementById('fileInput'),
            htmlInput: document.getElementById('htmlInput'),
            analyzeButton: document.getElementById('analyzeButton'),
            analysisOutput: document.getElementById('analysisOutput'),
            correctionContainer: document.getElementById('correctionContainer'),
            correctedHtmlOutput: document.getElementById('correctedHtmlOutput'),
            supabaseSuggestionContainer: document.getElementById('supabaseSuggestionContainer'),
            copyButton: document.getElementById('copyButton'),
            githubUser: document.getElementById('githubUser'),
            repoName: document.getElementById('repoName'),
            appName: document.getElementById('appName'),
            appShortName: document.getElementById('appShortName'),
            appDesc: document.getElementById('appDesc'),
            iconUpload: document.getElementById('iconUpload'),
            iconPreview: document.getElementById('iconPreview'),
            themeColor: document.getElementById('themeColor'),
            swStrategy: document.getElementById('swStrategy'),
            cacheVersion: document.getElementById('cacheVersion'),
            extraFiles: document.getElementById('extraFiles'),
            generateFooter: document.getElementById('generateFooter'),
            footerFields: document.getElementById('footerFields'),
            footerLine1: document.getElementById('footerLine1'),
            footerLine2: document.getElementById('footerLine2'),
            footerLine3: document.getElementById('footerLine3'),
            addSupabase: document.getElementById('addSupabase'),
            addPushNotifications: document.getElementById('addPushNotifications'),
            vapidKeyContainer: document.getElementById('vapidKeyContainer'),
            vapidKeyInput: document.getElementById('vapidKeyInput'),
            addBackgroundSync: document.getElementById('addBackgroundSync'),
            addShareTarget: document.getElementById('addShareTarget'),
            shareTargetFields: document.getElementById('shareTargetFields'),
            shareTargetAction: document.getElementById('shareTargetAction'),
            generateButton: document.getElementById('generateButton'),
            outputSection: document.getElementById('outputSection'),
            manifestOutput: document.getElementById('manifestOutput'),
            swOutput: document.getElementById('swOutput'),
            downloadButton: document.getElementById('downloadButton'),
            networkStatus: document.getElementById('networkStatus'),
            templateMinimal: document.getElementById('templateMinimal'),
            templateTodo: document.getElementById('templateTodo'),
            iconInitials: document.getElementById('iconInitials'),
            iconBgColor: document.getElementById('iconBgColor'),
            generateIconButton: document.getElementById('generateIconButton'),
            generateMaskableIcon: document.getElementById('generateMaskableIcon'),
            darkModeToggle: document.getElementById('darkModeToggle'),
            scrollIndicator: document.querySelector('.scroll-indicator'),
            prevBtn: document.getElementById('prev-btn'),
            nextBtn: document.getElementById('next-btn'),
            wizardProgress: document.getElementById('wizard-progress'),
            pwaUrlInput: document.getElementById('pwaUrlInput'),
            checkPwaButton: document.getElementById('checkPwaButton'),
            checkResults: document.getElementById('checkResults')
        };

        const infoTexts = {
            basis: { title: 'Basis-Infos', text: '<b>GitHub-Name & Repo:</b> Notwendig, um die korrekte Start-URL für Ihre PWA zu generieren.<br><b>App-Namen:</b> Der volle Name erscheint z.B. bei der Installation, der Kurzname auf dem Homescreen.<br><b>Beschreibung:</b> Eine kurze Info über Ihre App.'},
            icon: { title: 'App Icon', text: 'Laden Sie ein quadratisches Bild hoch (mind. 512x512px) oder nutzen Sie den Generator, um ein einfaches Icon mit Initialen zu erstellen. Dieses Icon erscheint auf dem Homescreen.'},
            maskable: { title: 'Maskable Icon', text: 'Ein "maskierbares" Icon stellt sicher, dass Ihr App-Logo auf allen Android-Geräten korrekt angezeigt wird, unabhängig von der vom System verwendeten Icon-Form (rund, quadratisch etc.). Es verhindert unschöne Ränder.' },
            design: { title: 'Design & Verhalten', text: '<b>Theme-Farbe:</b> Legt die Farbe der Adressleiste im Browser fest.<br><b>Shortcuts:</b> Erlaubt Schnellzugriffe, wenn man das App-Icon lange gedrückt hält (z.B. "Neuer Eintrag").'},
            caching: { title: 'Service Worker & Caching', text: '<b>Strategie:</b> Legt fest, wie Ihre App offline funktioniert. "Cache First" ist schneller, "Network First" liefert aktuellere Daten.<br><b>Cache-Version:</b> Ändern Sie dies (z.B. auf "v2"), um bei einem Update einen neuen Cache zu erzwingen.<br><b>Zusätzliche Dateien:</b> Listen Sie hier alle weiteren wichtigen Dateien auf (z.B. <code>style.css</code>), damit diese auch offline verfügbar sind.'},
            appOptions: { title: 'Optionen für generierte App', text: '<b>Text wählbar:</b> Legt fest, ob Nutzer den Text in Ihrer fertigen PWA markieren und kopieren können.<br><br><b>Footer einfügen:</b> Fügt der generierten App einen anpassbaren Footer am unteren Ende der Seite hinzu.' },
            advanced: { title: 'Erweiterte Funktionen', text: '<b>Supabase:</b> Bereitet Ihre App für eine sichere Datenbank-Anbindung vor.<br><b>Push-Benachrichtigungen:</b> Ermöglicht das Senden von Nachrichten an Ihre Nutzer, auch wenn die App geschlossen ist.<br><b>Hintergrund-Sync:</b> Lässt Ihre App Aktionen (z.B. Formular senden) im Hintergrund abschließen, sobald wieder Internet verfügbar ist.<br><b>Share Target:</b> Macht Ihre App im "Teilen"-Menü des Handys verfügbar.'}
        };

        ui.downloadButton.style.display = 'none';

        function showInfoModal(key, event) {
            event.preventDefault();
            event.stopPropagation();
            const info = infoTexts[key];
            if (info) {
                ui.modalTitle.innerHTML = info.title;
                ui.modalText.innerHTML = info.text;
                ui.infoModal.style.display = 'flex';
            }
        }
        document.querySelectorAll('.info-icon').forEach(icon => {
            const key = icon.dataset.infoKey;
            if(key && infoTexts[key]) {
                 icon.addEventListener('click', (e) => showInfoModal(key, e));
            }
        });

        function hideInfoModal() { ui.infoModal.style.display = 'none'; }

        // --- Event Listeners ---
        ui.tabsContainer.addEventListener('click', (e) => { if (e.target.matches('.tab-button')) showTab(e.target.dataset.tab); });
        ui.modalCloseButton.addEventListener('click', hideInfoModal);
        ui.infoModal.addEventListener('click', (e) => { if(e.target === ui.infoModal) hideInfoModal(); });
        ui.fileInput.addEventListener('change', loadFileAndAnalyze);
        ui.analyzeButton.addEventListener('click', () => analyzeHTML());
        ui.copyButton.addEventListener('click', () => copyCode('correctedHtmlOutput'));
        ui.iconUpload.addEventListener('change', handleIconUpload);
        ui.generateFooter.addEventListener('change', toggleFooterFields);
        ui.generateButton.addEventListener('click', generatePWA);
        ui.downloadButton.addEventListener('click', downloadZip);
        ui.templateMinimal.addEventListener('click', () => loadTemplate('minimal'));
        ui.templateTodo.addEventListener('click', () => loadTemplate('todo'));
        ui.generateIconButton.addEventListener('click', generateAndPreviewIcon);
        ui.addPushNotifications.addEventListener('change', (e) => { ui.vapidKeyContainer.style.display = e.target.checked ? 'block' : 'none'; });
        ui.addShareTarget.addEventListener('change', (e) => { ui.shareTargetFields.style.display = e.target.checked ? 'block' : 'none'; });
        ui.darkModeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
        ui.themeColor.addEventListener('input', (e) => { document.querySelector('header').style.background = e.target.value; });
        ui.prevBtn.addEventListener('click', () => navigateWizard(-1));
        ui.nextBtn.addEventListener('click', () => navigateWizard(1));
        ui.checkPwaButton.addEventListener('click', checkPwa);

        // --- Tab Scroll Indicator ---
        ui.tabsContainer.addEventListener('scroll', () => {
            const { scrollLeft, scrollWidth, clientWidth } = ui.tabsContainer;
            ui.scrollIndicator.classList.toggle('visible', scrollLeft + clientWidth < scrollWidth - 10);
        }, { passive: true });

        window.addEventListener('resize', () => {
             const { scrollWidth, clientWidth } = ui.tabsContainer;
             ui.scrollIndicator.classList.toggle('visible', scrollWidth > clientWidth);
        });

        loadSavedValues();
        showTab('tutorial');
        initNetworkStatus();
        window.dispatchEvent(new Event('resize'));
        updateWizardView();

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId)?.classList.add('active');
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tabId));
            if (tabId !== 'generate') {
                document.querySelector('header').style.background = '';
            } else {
                document.querySelector('header').style.background = ui.themeColor.value;
            }
        }

        function toggleFooterFields() { ui.footerFields.style.display = ui.generateFooter.checked ? 'block' : 'none'; }

        function handleIconUpload(e) {
            const file = e.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => { uploadedIconBase64 = e.target.result; ui.iconPreview.src = uploadedIconBase64; ui.iconPreview.style.display = 'block'; };
            reader.readAsDataURL(file);
        }

        function loadFileAndAnalyze() {
            const file = ui.fileInput.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => { ui.htmlInput.value = e.target.result; analyzeHTML(e.target.result); };
            reader.readAsText(file);
        }

        function analyzeHTML(inputHtmlOverride = null) {
             const inputHtml = inputHtmlOverride || ui.htmlInput.value;
            ui.supabaseSuggestionContainer.style.display = 'none';
            ui.supabaseSuggestionContainer.innerHTML = '';
            if (!inputHtml.trim()) {
                alert('Bitte geben Sie HTML-Code ein oder laden Sie eine Datei hoch!');
                return;
            }

            let results = [];
            let correctedHtml = inputHtml;
            const doc = new DOMParser().parseFromString(inputHtml, 'text/html');

            const titleMatch = doc.querySelector('title');
            if (titleMatch && titleMatch.textContent) {
                ui.appName.value = titleMatch.textContent.trim();
                results.push('<p><strong class="ok">✓ Titel-Tag:</strong> Gefunden und als App-Name übernommen.</p>');
            } else {
                results.push('<p><strong class="fail">✗ Titel-Tag:</strong> Fehlt. Wichtig für den App-Namen.</p>');
            }

            if (!doc.querySelector('meta[name="viewport"]')) {
                correctedHtml = correctedHtml.replace(/<head>/i, '$&\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">');
                results.push('<p><strong class="ok">✓ Viewport-Tag:</strong> Hinzugefügt für mobile Darstellung.</p>');
            }

            if (!doc.querySelector('link[rel="manifest"]')) {
                 results.push('<p><strong class="fail">✗ Manifest-Link:</strong> Fehlt (wird in der generierten App dynamisch hinzugefügt).</p>');
            } else {
                 results.push('<p><strong class="ok">✓ Manifest-Link:</strong> Vorhanden.</p>');
            }

            if (!/navigator\.serviceWorker\.register/.test(correctedHtml)) {
                 results.push('<p><strong class="fail">✗ Service Worker:</strong> Registrierung fehlt (wird in der generierten App dynamisch hinzugefügt).</p>');
            } else {
                 results.push('<p><strong class="ok">✓ Service Worker:</strong> Registrierung vorhanden.</p>');
            }

            const assets = [...doc.querySelectorAll('link[rel="stylesheet"][href], script[src]')]
                .map(el => el.getAttribute('href') || el.getAttribute('src'))
                .filter(path => path && !path.startsWith('http') && !path.startsWith('https'));

            if (assets.length > 0) {
                ui.extraFiles.value = assets.join(', ');
                results.push(`<p><strong class="ok">✓ Lokale Assets:</strong> <code>${assets.join(', ')}</code> erkannt und für Caching vorgemerkt.</p>`);
            }

            correctedHtmlForZip = correctedHtml;
            ui.analysisOutput.innerHTML = `<h4>Analyse-Ergebnisse:</h4>${results.join('')}`;
            ui.analysisOutput.style.display = 'block';
            ui.correctedHtmlOutput.value = correctedHtml;
            ui.correctionContainer.style.display = 'block';

            const inputs = doc.querySelectorAll('input[id][type="text"], input[id][type="number"], input[id][type="email"], textarea[id]');
            if (inputs.length > 0) {
                const rawTableName = titleMatch ? titleMatch.textContent.trim() : 'app_data';
                const sanitizedTableName = rawTableName.toLowerCase().replace(/[^a-z0-9_]+/g, '_').replace(/^_|_$/g, '');

                let detectedColumns = [];
                inputs.forEach(input => {
                    const colName = input.id.replace(/-/g, '_');
                    const dataType = input.type === 'number' ? 'int8' : 'text';
                    const safeTag = input.outerHTML.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    detectedColumns.push({name: colName, type: dataType, tag: safeTag});
                });

                ui.supabaseSuggestionContainer.innerHTML = generateSupabaseSuggestionHtml(sanitizedTableName, detectedColumns);
                ui.supabaseSuggestionContainer.style.display = 'block';

                setTimeout(() => {
                    const copyBtn = document.getElementById('copySqlButton');
                    if (copyBtn) {
                        copyBtn.onclick = () => copySqlToClipboard(sanitizedTableName, detectedColumns);
                    }
                    ui.supabaseSuggestionContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function generateSupabaseSuggestionHtml(tableName, columns) {
             let detectedRowsHtml = columns.map(col => `
                <tr style="border-bottom: 1px solid #e2e8f0;">
                    <td style="padding: 12px 15px; font-weight: 500;"><code>${col.name}</code></td>
                    <td style="padding: 12px 15px;"><code>${col.type}</code></td>
                    <td style="padding: 12px 15px; font-size: 0.9rem;">✔️ <strong>Automatisch erkannt</strong> aus <code>${col.tag}</code>.</td>
                </tr>`).join('');

            const nameHint = columns.length > 0 ? `Der Name wurde vom <code>&lt;title&gt;</code>-Tag Ihrer HTML abgeleitet (oder ist '${tableName}', falls kein Titel vorhanden war) und bereinigt. <strong>Sie können diesen Namen in Supabase ändern!</strong>` : '';

            return `
                <h4 style="font-size: 1.2rem; display: flex; align-items: center; margin-bottom: 0;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 10px;"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                    Vorschlag für Supabase-Tabelle:
                </h4>
                <div class="table-name-display"><code>${tableName}</code></div>
                <p style="font-size: 0.9rem; margin-top: 10px; line-height: 1.5;">Basierend auf deiner HTML-Datei haben wir diese Tabellenstruktur generiert. ${nameHint} Du kannst sie als Vorlage für dein Supabase-Projekt verwenden.</p>
                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <h5>Anleitung:</h5>
                    <ol style="font-size: 0.9rem; margin-left: 20px; line-height: 1.6;">
                        <li>Gehen Sie zu Ihrem Supabase-Projekt und klicken Sie auf den <strong>Table Editor</strong>.</li>
                        <li>Klicken Sie auf <strong>"Create a new table"</strong> (oder gehen Sie zum <strong>SQL Editor</strong>).</li>
                        <li>Nutzen Sie die untere Tabelle als Vorlage oder <strong>kopieren Sie direkt den SQL-Befehl</strong>, um Fehler zu vermeiden.</li>
                    </ol>
                </div>
                <div style="overflow-x: auto; margin-top: 1.5rem;">
                    <table style="width: 100%; border-collapse: collapse; text-align: left; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                         <thead style="background-color: rgba(127, 255, 212, 0.2);">
                            <tr>
                                <th style="padding: 12px 15px; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Spaltenname</th>
                                <th style="padding: 12px 15px; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Supabase-Typ</th>
                                <th style="padding: 12px 15px; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Beschreibung & Hinweise</th>
                            </tr>
                        </thead>
                        <tbody style="background-color: var(--card-background);">
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 12px 15px; font-weight: 500;"><code>id</code></td>
                                <td style="padding: 12px 15px;"><code>uuid</code></td>
                                <td style="padding: 12px 15px; font-size: 0.9rem;">⭐ <strong>Primärschlüssel</strong>. Eindeutige ID für jeden Eintrag.</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 12px 15px; font-weight: 500;"><code>created_at</code></td>
                                <td style="padding: 12px 15px;"><code>timestamptz</code></td>
                                <td style="padding: 12px 15px; font-size: 0.9rem;">⏱️ Zeitstempel der Erstellung (wird automatisch gesetzt).</td>
                            </tr>
                            ${detectedRowsHtml}
                            <tr style="border-bottom: 1px solid #e2e8f0;">
                                <td style="padding: 12px 15px; font-weight: 500;"><code>is_complete</code></td>
                                <td style="padding: 12px 15px;"><code>boolean</code></td>
                                <td style="padding: 12px 15px; font-size: 0.9rem;">💡 Empfehlung: Um den Status (erledigt/offen) zu speichern.</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px 15px; font-weight: 500;"><code>user_id</code></td>
                                <td style="padding: 12px 15px;"><code>uuid</code></td>
                                <td style="padding: 12px 15px; font-size: 0.9rem;">💡 Empfehlung: Um die Aufgabe einem Benutzer zuzuordnen.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button id="copySqlButton" class="copy-btn" style="width: auto; padding: 10px 15px; font-size: 0.95rem;">📋 Als SQL-Befehl kopieren</button>
            `;
        }


        function copySqlToClipboard(tableName, columns) {
            let columnDefs = columns.map(c => `  ${c.name} ${c.type}`).join(',\n');
            const sql = `CREATE TABLE ${tableName} (\n  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n  created_at timestamptz DEFAULT now() NOT NULL,\n${columnDefs},\n  is_complete boolean DEFAULT false,\n  user_id uuid REFERENCES auth.users(id)\n);\n\n-- Optional: Enable Row Level Security (RLS)\nALTER TABLE ${tableName} ENABLE ROW LEVEL SECURITY;`;
            navigator.clipboard.writeText(sql).then(() => alert('SQL-Befehl in die Zwischenablage kopiert!'));
        }

        async function generatePWA() {
            const v = {
                user: ui.githubUser.value.trim(), repo: ui.repoName.value.trim().replace(/\s+/g, '-'), app: ui.appName.value.trim(), shortApp: ui.appShortName.value.trim() || ui.appName.value.trim(),
                desc: ui.appDesc.value.trim(), theme: ui.themeColor.value, ver: ui.cacheVersion.value.trim(), strategy: ui.swStrategy.value, extras: ui.extraFiles.value.split(',').map(f => f.trim()).filter(f => f),
                maskable: ui.generateMaskableIcon.checked,
                backgroundSync: ui.addBackgroundSync.checked,
                shareTarget: ui.addShareTarget.checked,
                shareAction: ui.shareTargetAction.value.trim()
            };
            if (!v.user || !v.repo || !v.app || !uploadedIconBase64) return alert('Bitte alle Felder ausfüllen & Icon hochladen/generieren.');

            const startUrl = `/${v.repo}/`;
            const manifestObject = {
                name: v.app, short_name: v.shortApp, start_url: startUrl, display: "standalone",
                description: v.desc, background_color: "#ffffff", theme_color: v.theme
            };

            manifestObject.icons = [
                { src: "icons/icon-192x192.png", sizes: "192x192", type: "image/png", purpose: "any" },
                { src: "icons/icon-512x512.png", sizes: "512x512", type: "image/png", purpose: "any" }
            ];
            if (v.maskable) {
                manifestObject.icons.push({ src: "icons/icon-maskable-512x512.png", sizes: "512x512", type: "image/png", purpose: "maskable" });
            }

            if (v.shareTarget && v.shareAction) {
                manifestObject.share_target = { action: startUrl.slice(0, -1) + v.shareAction, method: "GET", params: { title: "title", text: "text", url: "url" } };
                pwaArtifacts.shareReceiverHtml = `<!DOCTYPE html><html><head><title>Empfangene Daten</title></head><body><h1>Geteilte Inhalte:</h1><script>const p=new URLSearchParams(window.location.search);document.body.innerHTML+='<p><b>Titel:</b> '+(p.get('title')||'N/A')+'</p><p><b>Text:</b> '+(p.get('text')||'N/A')+'</p><p><b>URL:</b> '+(p.get('url')||'N/A')+'</p>';<\/sc`+`ript>
  <script>
    if ('serviceWorker' in navigator) {
      const swPath = basePath + 'sw.js';
      navigator.serviceWorker.register(swPath)
        .then(() => console.log('Service Worker registered:', swPath))
        .catch(err => console.error('SW registration failed:', err));
    }
  <\/script>

<button id="installFab" title="App installieren" style="display: none; position: fixed; bottom: 90px; right: 20px; width: 56px; height: 56px; background-color: #1e40af; color: white; border: none; border-radius: 50%; font-size: 24px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 1000; justify-content: center; align-items: center;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
</button>

<script>
  let deferredPrompt;
  const installButton = document.getElementById('installFab');

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    if (installButton) {
      installButton.style.display = 'flex';
    }
  });

  if (installButton) {
    installButton.addEventListener('click', async () => {
      installButton.style.display = 'none';
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log('User choice:', outcome);
        deferredPrompt = null;
      }
    });
  }

  window.addEventListener('appinstalled', () => {
     if (installButton) {
        installButton.style.display = 'none';
     }
    deferredPrompt = null;
    console.log('PWA wurde installiert');
  });
<\/script></body></html>`;
            }
            pwaArtifacts.manifest = JSON.stringify(manifestObject, null, 2);

            const assetsToCache = [`${startUrl}`, `${startUrl}index.html`, `${startUrl}manifest.json`, `${startUrl}offline.html`];
            if(v.extras.length > 0) {
                 assetsToCache.push(...v.extras.map(f => `${startUrl}${f}`));
            }
            const assets = JSON.stringify(assetsToCache);
            const offlineUrl = `${startUrl}offline.html`;
            const fetchHandler = v.strategy === 'network-first' ? `fetch(e.request).catch(() => caches.match("${offlineUrl}"))` : `caches.match(e.request).then(r => r || fetch(e.request)).catch(() => caches.match("${offlineUrl}"))`;
            let swContent = `const CN='pwa-cache-${v.ver}';const URLS=${assets};self.addEventListener('install',e=>e.waitUntil(caches.open(CN).then(c=>c.addAll(URLS))));self.addEventListener('fetch',e=>e.respondWith(${fetchHandler}));`;
            pwaArtifacts.offlineHtml = `<!DOCTYPE html><html><head><title>Offline</title><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body style="font-family: sans-serif; text-align: center; padding: 2rem;"><h1>Offline</h1><p>Du bist momentan nicht mit dem Internet verbunden.</p></body></html>`;

            try {
                const iconPromises = [scaleIcon(uploadedIconBase64, 192, false), scaleIcon(uploadedIconBase64, 512, false)];
                if (v.maskable) { iconPromises.push(scaleIcon(uploadedIconBase64, 512, true)); }
                const [icon192, icon512, maskableIcon512] = await Promise.all(iconPromises);
                pwaArtifacts.icon192 = icon192; pwaArtifacts.icon512 = icon512; pwaArtifacts.maskableIcon512 = maskableIcon512 || null;
            } catch (e) { return alert('Fehler beim Skalieren des Icons.'); }

            let appJsContent = '';
            if (ui.addSupabase.checked) {
                pwaArtifacts.supabaseClient = `import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';\nexport const supabase = createClient('__SUPABASE_URL__', '__SUPABASE_ANON_KEY__');`;
                appJsContent += `import { supabase } from './supabaseClient.js'; console.log('Supabase client loaded!');\n`;
                pwaArtifacts.githubWorkflow = `name: Deploy\non: {push: {branches: [main]}}\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - run: sed -i "s|__SUPABASE_URL__|\\\${{ secrets.SUPABASE_URL }}|g; s|__SUPABASE_ANON_KEY__|\\\${{ secrets.SUPABASE_ANON_KEY }}|g" supabaseClient.js\n      - uses: JamesIves/github-pages-deploy-action@v4\n        with:\n          branch: gh-pages\n          folder: .`;
            } else { pwaArtifacts.supabaseClient = null; pwaArtifacts.githubWorkflow = null; }

            if (ui.addPushNotifications.checked) {
                swContent += `\n\nself.addEventListener('push',e=>{const d=e.data.json();self.registration.showNotification(d.title,{body:d.body,icon:'icons/icon-192x192.png'})});`;
                const vapidKey = ui.vapidKeyInput.value.trim() || 'YOUR_PUBLIC_VAPID_KEY';
                appJsContent += `console.log('Push script active.'); const vapidKey='${vapidKey}';\n`;
            }
             if (v.backgroundSync) {
                swContent += `\n\nself.addEventListener('sync', e => { if (e.tag === 'my-sync-tag') { e.waitUntil(console.log('Sync event fired!')); } });`;
                appJsContent += `\nasync function registerSync() { try { const reg = await navigator.serviceWorker.ready; await reg.sync.register('my-sync-tag'); } catch { console.log('Sync registration failed'); } }\n`;
            }
            pwaArtifacts.sw = swContent;
            if (appJsContent) pwaArtifacts.appJs = appJsContent;

            ui.manifestOutput.value = pwaArtifacts.manifest;
            ui.swOutput.value = pwaArtifacts.sw;
            ui.outputSection.style.display = 'block';
            ui.downloadButton.style.display = 'flex';
            alert('Generierung erfolgreich!');
            saveSettings();
        }

        async function downloadZip() {
            if (!pwaArtifacts.manifest) return;
            ui.downloadButton.disabled = true; ui.downloadButton.textContent = '...';

            try {
                const zip = new JSZip();
                let html = correctedHtmlForZip || `<!DOCTYPE html><html><head><title>${ui.appName.value}</title></head><body></body></html>`;

                 const dynamicHeadScript = `
    <script>
      const basePath = window.location.pathname.split('/').filter(Boolean)[0]
                       ? '/' + window.location.pathname.split('/')[0] + '/'
                       : '/';
      const manifestLink = document.createElement('link');
      manifestLink.rel = 'manifest';
      manifestLink.href = basePath + 'manifest.json';
      document.head.appendChild(manifestLink);
    <\/script>`;

                const dynamicBodyScript = `
  <script>
    if ('serviceWorker' in navigator) {
      const swPath = basePath + 'sw.js';
      navigator.serviceWorker.register(swPath)
        .then(() => console.log('Service Worker registered:', swPath))
        .catch(err => console.error('SW registration failed:', err));
    }
  <\/script>`;

                html = html.replace('</head>', `${dynamicHeadScript}\n</head>`);
                html = html.replace('</body>', `${dynamicBodyScript}\n</body>`);

                const themeColor = ui.themeColor.value;
                if (html.includes('<meta name="theme-color"')) {
                    html = html.replace(/<meta name="theme-color" content="[^"]*">/g, `<meta name="theme-color" content="#1e40af">`);
                } else {
                    html = html.replace('</head>', `  <meta name="theme-color" content="#1e40af">\n</head>`);
                }
                // Füge User-Select Style *nur* ein, wenn es deaktiviert ist
                if (document.querySelector('input[name="userSelect"]:checked').value === 'disabled') {
                    html = html.replace('</head>', `<style>body{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style>\n</head>`);
                }
                // Füge erlaubende Styles für Input/Textarea/Code hinzu (damit Copy/Paste geht)
                 html = html.replace('</head>', `<style>input, textarea, code { user-select: text !important; -webkit-user-select: text !important; -moz-user-select: text !important; -ms-user-select: text !important; }</style>\n</head>`);

                if (ui.generateFooter.checked) {
                    // Verwende die Texte aus den Feldern, nicht die Branding-Texte
                    const footerHtml = `<footer style="text-align:center;padding:1.5rem;background-color:#1f2937;color:#d1d5db;font-size:0.75rem;"><p>${ui.footerLine1.value}</p><p>${ui.footerLine2.value}</p><p><a href="mailto:${ui.footerLine3.value}" style="color:#3b82f6;text-decoration:none;">${ui.footerLine3.value}</a></p></footer>`;
                    html = html.replace(/<\/body>/i, `${footerHtml}\n$&`);
                }

                if (pwaArtifacts.appJs) {
                    html = html.replace(/<\/body>/i, `<script type="module" src="app.js"><\/sc`+`ript>\n$&`);
                    zip.file('app.js', pwaArtifacts.appJs);
                }
                if (pwaArtifacts.supabaseClient) {
                    zip.file('supabaseClient.js', pwaArtifacts.supabaseClient);
                    zip.folder('.github').folder('workflows').file('deploy.yml', pwaArtifacts.githubWorkflow);
                }
                if (pwaArtifacts.shareReceiverHtml) {
                    const actionPath = ui.shareTargetAction.value.trim().startsWith('/') ? ui.shareTargetAction.value.trim().substring(1) : ui.shareTargetAction.value.trim();
                    zip.file(actionPath || 'receive-share.html', pwaArtifacts.shareReceiverHtml);
                }

                const fabHtml = `
<button id="installFab" title="App installieren" style="display: none; position: fixed; bottom: 90px; right: 20px; width: 56px; height: 56px; background-color: ${themeColor}; color: white; border: none; border-radius: 50%; font-size: 24px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 1000; justify-content: center; align-items: center;">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
</button>`;

                const fabScript = `
<script>
  let deferredPrompt;
  const installButton = document.getElementById('installFab');

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    if (installButton) {
      installButton.style.display = 'flex';
    }
  });

  if (installButton) {
    installButton.addEventListener('click', async () => {
      installButton.style.display = 'none';
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log('User choice:', outcome);
        deferredPrompt = null;
      }
    });
  }

  window.addEventListener('appinstalled', () => {
     if (installButton) {
        installButton.style.display = 'none';
     }
    deferredPrompt = null;
    console.log('PWA wurde installiert');
  });
<\/script>`;

                html = html.replace('</body>', `${fabHtml}\n${fabScript}\n</body>`);

                zip.file('index.html', html);
                zip.file('manifest.json', pwaArtifacts.manifest);
                zip.file('sw.js', pwaArtifacts.sw);
                zip.file('offline.html', pwaArtifacts.offlineHtml);
                const iconsFolder = zip.folder('icons');
                iconsFolder.file('icon-192x192.png', pwaArtifacts.icon192, { base64: true });
                iconsFolder.file('icon-512x512.png', pwaArtifacts.icon512, { base64: true });
                if (pwaArtifacts.maskableIcon512) { iconsFolder.file('icon-maskable-512x512.png', pwaArtifacts.maskableIcon512, { base64: true }); }

                const blob = await zip.generateAsync({ type: 'blob' });
                saveAs(blob, 'pwa-files.zip');
            } finally {
                ui.downloadButton.disabled = false; ui.downloadButton.textContent = '⬇️';
            }
        }


        async function checkPwa() {
            const url = ui.pwaUrlInput.value.trim();
            if (!url || !url.startsWith('http')) {
                ui.checkResults.innerHTML = '<p class="fail">Bitte geben Sie eine gültige, vollständige URL ein (beginnend mit http/https).</p>';
                return;
            }

            ui.checkResults.innerHTML = `<ul>
                <li id="check-https"></li>
                <li id="check-manifest"></li>
                <li id="check-sw"></li>
                <li id="check-theme"></li>
            </ul>
            <p style="font-size: 0.8rem; color: var(--subtle-text); margin-top: 1rem;">Hinweis: Dies ist eine einfache Prüfung und ersetzt keinen vollständigen PWA-Audit (z.B. mit Lighthouse).</p>`;

            const checkItem = async (id, text, checkFn) => {
                const li = document.getElementById(id);
                li.innerHTML = `<span class="spinner"></span> ${text}`;
                const { success, message } = await checkFn();
                li.innerHTML = `${success ? '✔️' : '❌'} ${text} ${message ? `(${message})` : ''}`;
            };

            checkItem('check-https', 'Verbindung ist sicher (HTTPS)', async () => ({ success: url.startsWith('https://') }));

            let htmlContent = '';
            try {
                const response = await fetch(url, { cache: 'no-cache' });
                if (!response.ok) throw new Error(`HTML nicht erreichbar: ${response.status}`);
                htmlContent = await response.text();
            } catch (e) {
                ui.checkResults.innerHTML = `<p class="fail">Konnte die Haupt-URL nicht abrufen: ${e.message}.<br>Stellen Sie sicher, dass das PWA-Studio selbst auch online (z.B. auf GitHub) läuft, um CORS-Fehler zu vermeiden.</p>`;
                return;
            }

            checkItem('check-theme', 'Theme-Farbe im HTML gesetzt', async () => {
                const doc = new DOMParser().parseFromString(htmlContent, 'text/html');
                return { success: !!doc.querySelector('meta[name="theme-color"]') };
            });

            checkItem('check-manifest', 'Manifest-Datei ist gültig', async () => {
                const doc = new DOMParser().parseFromString(htmlContent, 'text/html');
                const manifestLink = doc.querySelector('link[rel="manifest"]');
                if (!manifestLink) return { success: false, message: 'Kein <link rel="manifest"> gefunden' };

                const manifestUrl = new URL(manifestLink.href, url);
                try {
                    const res = await fetch(manifestUrl, { cache: 'no-cache' });
                    if (!res.ok) return { success: false, message: `Fehler ${res.status}` };
                    const text = await res.text();
                    if (text.length === 0) return { success: false, message: 'Datei ist leer' };
                    const manifest = JSON.parse(text); // Check if valid JSON
                    if (manifest.icons && manifest.start_url) {
                        return { success: true, message: `Gefunden: ${manifestLink.href}` };
                    }
                    return { success: false, message: 'Inhalt unvollständig' };
                } catch (e) { return { success: false, message: 'Nicht erreichbar/lesbar' }; }
            });

            checkItem('check-sw', 'Service Worker registriert & erreichbar', async () => {
                const swRegex = /navigator\.serviceWorker\.register\(\s*(?:basePath\s*\+\s*)?['"](.*?\.js)['"]\s*\)/;
                const match = htmlContent.match(swRegex);
                if (!match || !match[1]) return { success: false, message: 'Keine SW-Registrierung im HTML gefunden' };

                const swPath = match[1];
                const swUrl = new URL(swPath, url);

                try {
                    const res = await fetch(swUrl, { cache: 'no-cache' });
                    if (!res.ok) return { success: false, message: `Fehler ${res.status} bei ${swPath}` };
                    const text = await res.text();
                    if (text.length === 0) return { success: false, message: `${swPath} ist leer` };
                    return { success: true, message: `Gefunden: ${swPath}` };
                } catch (e) { return { success: false, message: `${swPath} nicht erreichbar` }; }
            });
        }

        function scaleIcon(base64, size, isMaskable = false) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas'); canvas.width = size; canvas.height = size;
                    const ctx = canvas.getContext('2d');
                    if (isMaskable) {
                        const bgColor = ui.iconBgColor.value;
                        ctx.fillStyle = bgColor;
                        ctx.fillRect(0, 0, size, size);
                        const iconSize = size * 0.8;
                        const offset = (size - iconSize) / 2;
                        ctx.drawImage(img, offset, offset, iconSize, iconSize);
                    } else {
                        ctx.drawImage(img, 0, 0, size, size);
                    }
                    resolve(canvas.toDataURL('image/png').split(',')[1]);
                };
                img.onerror = reject;
                img.src = base64;
            });
        }

        function copyCode(id) { document.getElementById(id).select(); document.execCommand('copy'); alert('Kopiert!'); }

        function loadTemplate(templateName) {
            if (templateName === 'minimal') { ui.htmlInput.value = `<!DOCTYPE html>\n<html lang="de">\n<head>\n    <meta charset="UTF-8">\n    <title>Minimale PWA</title>\n</head>\n<body>\n    <h1>Hallo Welt!</h1>\n</body>\n</html>`;
            } else if (templateName === 'todo') { ui.htmlInput.value = `<!DOCTYPE html>\n<html lang="de">\n<head>\n    <meta charset="UTF-8">\n    <title>Todo App</title>\n</head>\n<body>\n    <h1>Todo App</h1>\n    <input type="text" id="new-todo" placeholder="Neue Aufgabe...">\n    <button id="add-btn">Add</button>\n    <ul id="todo-list"></ul>\n</body>\n</html>`; }
            analyzeHTML();
        }

        function generatePlaceholderIcon(initials, bgColor) {
            const canvas = document.createElement('canvas'); canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = bgColor; ctx.fillRect(0, 0, 512, 512);
            ctx.fillStyle = '#FFFFFF'; ctx.font = 'bold 200px sans-serif';
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillText(initials.toUpperCase(), 256, 256);
            return canvas.toDataURL('image/png');
        }

        function generateAndPreviewIcon() {
            const initials = ui.iconInitials.value;
            const bgColor = ui.iconBgColor.value;
            if (!initials) return alert('Bitte Initialen eingeben.');
            const generatedIcon = generatePlaceholderIcon(initials, bgColor);
            uploadedIconBase64 = generatedIcon;
            ui.iconPreview.src = generatedIcon;
            ui.iconPreview.style.display = 'block';
        }

        function saveSettings() {
            const settings = {
                githubUser: ui.githubUser.value, repoName: ui.repoName.value, appName: ui.appName.value, appShortName: ui.appShortName.value,
                appDesc: ui.appDesc.value, themeColor: ui.themeColor.value, swStrategy: ui.swStrategy.value, cacheVersion: ui.cacheVersion.value, extraFiles: ui.extraFiles.value,
                userSelect: document.querySelector('input[name="userSelect"]:checked').value, generateFooter: ui.generateFooter.checked,
                addSupabase: ui.addSupabase.checked, addPushNotifications: ui.addPushNotifications.checked, vapidKeyInput: ui.vapidKeyInput.value, addBackgroundSync: ui.addBackgroundSync.checked, addShareTarget: ui.addShareTarget.checked, shareTargetAction: ui.shareTargetAction.value,
                footerLine1: ui.footerLine1.value, footerLine2: ui.footerLine2.value, footerLine3: ui.footerLine3.value,
                iconInitials: ui.iconInitials.value, iconBgColor: ui.iconBgColor.value, generateMaskableIcon: ui.generateMaskableIcon.checked
            };
            localStorage.setItem('pwaStudioSettings', JSON.stringify(settings));
        }

        function loadSavedValues() {
            const settings = JSON.parse(localStorage.getItem('pwaStudioSettings'));
            if (!settings) return;
            ui.githubUser.value = settings.githubUser || '';
            ui.repoName.value = settings.repoName || '';
            ui.appName.value = settings.appName || 'Meine PWA App';
            ui.appShortName.value = settings.appShortName || 'PWA App';
            ui.appDesc.value = settings.appDesc || '';
            ui.themeColor.value = settings.themeColor || '#1e40af';
            ui.swStrategy.value = settings.swStrategy || 'cache-first';
            ui.cacheVersion.value = settings.cacheVersion || 'v1';
            ui.extraFiles.value = settings.extraFiles || '';
            const userSelectRadio = document.querySelector(`input[name="userSelect"][value="${settings.userSelect || 'disabled'}"]`);
            if(userSelectRadio) userSelectRadio.checked = true;
            ui.generateFooter.checked = settings.generateFooter || false;
            ui.addSupabase.checked = settings.addSupabase || false;
            ui.addPushNotifications.checked = settings.addPushNotifications || false;
            ui.vapidKeyInput.value = settings.vapidKeyInput || '';
            ui.vapidKeyContainer.style.display = ui.addPushNotifications.checked ? 'block' : 'none';
            ui.addBackgroundSync.checked = settings.addBackgroundSync || false;
            ui.addShareTarget.checked = settings.addShareTarget || false;
            ui.shareTargetAction.value = settings.shareTargetAction || '/receive-share';
            ui.shareTargetFields.style.display = ui.addShareTarget.checked ? 'block' : 'none';
            toggleFooterFields();
            // Lade Footer-Werte nur, wenn Checkbox aktiv war (optional, für Konsistenz)
            // Aber verwende die Standardwerte aus dem Branding als Fallback, falls die Checkbox _später_ aktiviert wird
            ui.footerLine1.value = settings.footerLine1 || 'PWA Studio Pro © 2025 – Build • Analyze • Deploy';
            ui.footerLine2.value = settings.footerLine2 || 'Entwickelt von Björn Voss aka Omega';
            ui.footerLine3.value = settings.footerLine3 || 'voss.1980@gmail.com';

            ui.iconInitials.value = settings.iconInitials || '';
            ui.iconBgColor.value = settings.iconBgColor || '#3b82f6';
            ui.generateMaskableIcon.checked = settings.generateMaskableIcon || false;

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) applyTheme(savedTheme);
            else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) applyTheme('dark');
        }

        function initNetworkStatus() {
            function updateStatus() {
                ui.networkStatus.className = navigator.onLine ? 'status-online' : 'status-offline';
                ui.networkStatus.textContent = 'PWA Studio Pro: ' + (navigator.onLine ? 'Online' : 'Offline'); // Branding

                if (navigator.onLine && 'serviceWorker' in navigator) {
                    navigator.serviceWorker.register('sw.js')
                        .then(() => console.log('PWA-Studio Service Worker registriert.'))
                        .catch(err => console.error('PWA-Studio SW-Registrierung fehlgeschlagen:', err));
                }
            }
            window.addEventListener('online', updateStatus);
            window.addEventListener('offline', updateStatus);
            updateStatus();
        }

        function applyTheme(theme) {
            document.documentElement.classList.toggle('dark', theme === 'dark');
        }

        // --- Wizard Navigation ---
        function navigateWizard(direction) {
            const newStep = currentWizardStep + direction;
            if (newStep < 1 || newStep > totalWizardSteps) return;
            currentWizardStep = newStep;
            updateWizardView();
        }

        function updateWizardView() {
            document.querySelectorAll('.wizard-step').forEach(step => step.classList.remove('active'));
            document.getElementById(`wizard-step-${currentWizardStep}`)?.classList.add('active');

            ui.prevBtn.style.display = currentWizardStep === 1 ? 'none' : 'block';
            ui.nextBtn.style.display = currentWizardStep === totalWizardSteps ? 'none' : 'block';
            ui.generateButton.style.display = currentWizardStep === totalWizardSteps ? 'block' : 'none';

            ui.wizardProgress.style.width = `${(currentWizardStep / totalWizardSteps) * 100}%`;
        }
    }); // <-- KORREKTES ENDE
  </script>
</body>
</html>
